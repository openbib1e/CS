# Chapter04. CPU의 작동 원리

# 04-2. 레지스터

레지스터는 CPU 내부의 작은 임시 저장장치로 앞에서 배운 ALU나 제어장치보다 프로그래머 입장에서는 조금 더 중요하다.  
개발하는 프로그램 속 명령어나 데이터들의 관련 값들은 실행 전, 후로 레지스터에 저장되고 이 값들을 관찰할 수 있다.

또한 개발자가 ALU나 제어장치를 직접적으로 다루는 일도 레지스터에 비해서는 적다.

## 반드시 알아야 할 레지스터

CPU 내부에는 다양한 레지스터가 있고 각기 다른 역할을 가진다.

레지스터의 종류는 CPU마다 이름, 크기, 종류가 매우 다양하고 같은 용도의 레지스터도 CPU마다 이름이 다르다.

그럼에도 CPU마다 공통적으로 사용하는 레지스터가 있다.

### 프로그램 카운터(PC, Program Counter)
- 메모리에서 가져올 명령어의 주소, 즉 메모리에서 읽어 들일 명령어의 주소 저장
- 명령어 포인터(IP, Instruction Pointer)라고 부르는 CPU도 있다

#### 순차적인 실행 흐름이 끊기는 경우

프로그램 카운터(PC)는 꾸준히 증가하면서 프로그램을 차례대로 실행한다.  
하지만 프로그램 카운터가 실행 중인 명령어의 다음 주소가 아닌 전혀 다른 값으로 업데이트 되는 경우가 있다.

실행 중인 명령어의 다음 번지 주소가 아닌 명령어의 명시된 특정 메모리 주소(JUMP, CONDITIONAL, CALL ...)로 실행 흐름을 이동하거나, 인터럽트가 발생하는 경우 흐름이 끊기게 된다.

### 명령어 레지스터(IR, Instruction Register)

- 해석할 명령어, 즉 방금 메모리에서 읽어 들인 명령어를 저장
- 명령어 레지스터에 저장된 명령어를 제어장치가 받아들이고 해석한 뒤 제어 신호를 보냄

### 메모리 주소 레지스터(MAR, Memory Address Register)

- 메모리의 주소 저장
- CPU가 읽어 들이고자 하는 주소 값을 주소 버스로 보낼 때 임시저장

### 메모리 버퍼 레지스터(MBR, Memory Buffer Register)

- 메모리와 주고 받을 값(데이터와 명령어)을 저장
- CPU가 데이터 버스로 주고 받을 값은 MBR에 임시저장

### 플래그 레지스터(flag register)

- ALU 연산 결과 또는 CPU 상태에 대한 부가적인 정보 저장

### 범용 레지스터(general purpose register)

- 다양하고 일반적인 상황에서 자유롭게 사용
- MAR는 주소 값만, MBR는 명령어와 데이터만 저장한다면, 범용 레지스터의 경우 데이터와 주소를 모두 저장
- 일반적으로 CPU 안에 여러 개의 범용 레지스터를 가짐

### 스택 포인터

- 스택 주소 지정 방식에서 스택의 꼭대기를 가리키는 레지스터
- 스택의 어디까지 데이터가 채워져 있는지에 대한 표시
- 스택은 메모리 안에 스택 영역으로 데이터가 쌓이는 부분이 존재함

### 베이스 레지스터

- 변위 주소 지정 방식(displacement addressing mode)에서 사용하는 레지스터
- 변위 주소 지정 방식은 오퍼랜드 필드값(변위)과 특정 레지스터의 값을 더해서 유효 주소를 얻는 방식
- 변위 주소 지정 방식을 사용하는 명령어는 연산 코드 필드, 레지스터 필드, 오퍼랜드 필드를 명시

#### 변위 주소 지정 방식

CPU마다 방식은 다르지만 대부분 공통적으로 변위 주소 지정 방식은 두 가지가 있다.

- 상대 주소 지정 방식(relative addressing mode)
    - 오퍼랜드 필드값(변위)과 프로그램 카운터 값을 더하여 유효 주소 얻기
    - 프로그램 카운터에는 읽어 들일 명령어의 주소가 저장되어 있고, 오퍼랜드 값에 따라서 읽어 들이기로한 명령어로부터 몇 번째로 떨어져 있는 명령어를 실행
- 베이스 레지스터 주소 지정 방식(base-register addressing mode)
    - 오퍼랜드와 필드값(변위)과 베이스 레지스터 값을 더하여 유효 주소 얻기
    - 베이스 레지스터에는 기준이 되는 주소값을 가짐
    - 베이스 레지스터의 기준값 주소로부터 오퍼랜드 필드값만큼 떨어진 명령어 실행