# Chapter06. 메모리와 캐시 메모리

# 06-2. 메모리의 주소 공간

## 물리 주소와 논리 주소

CPU는 현재 실행 중인 프로그램이 메모리 몇 번지에 어떤 값이 들어있는지 모든 데이터의 주소값을 알지 못 한다.

그 이유는 메모리에 저장된 정보는 시시각각 변하기 때문이다.

새롭게 시작되는 프로그램이 시시때때로 적재되고, 실행이 끝난 프로그램은 삭제된다.  
같은 프로그램을 실행하더라도 실행할 때마다 적재되는 주소는 달라질 수 있다.

이러한 점을 극복하기 위해 주소 체계를 `물리 주소`와 `논리 주소`로 나누게 되었다.

1. 물리 주소(physical address)
    - 메모리 입장에서 바라본 주소
    - 실제로 메모리에 저장된 하드웨어상의 주소
2. 논리 주소(logical address)
    - CPU와 실행 중인 프로그램 입장에서 바라본 주소
    - 실행 중인 프로그램 각각에게 부여된 0번지부터 시작하는 주소

CPU의 입장에서 논리 주소는 중복된 값으로 사용해도 된다.  
게임의 0번지, 브라우저의 0번지 등등..

하지만 CPU가 메모리와 상호작용하려면 논리 주소와 물리 주소 간의 변환이 이루어져야 한다.

논리 주소와 물리 주소 간의 변환은 CPU와 주소 버스 사이에 위치한 **메모리 관리 장치**(Memory Management Unit, MMU)라는 하드웨어에 의해 수행된다.

```mermaid
graph LR
A[CPU] -- 논리 주소 --> B[MMU] -- 물리 주소 --> C[메모리]
```

MMU는 논리 주소와 베이스 레지스터(프로그램의 기준 주소, 물리 주소 상의 시작 주소) 값을 더하여 논리 주소를 물리 주소로 변환한다.  
즉, 베이스 레지스터에는 프로그램의 가장 첫 물리 주소를 저장하고,  
논리 주소는 프로그램의 시작점으로부터 떨어진 거리가 되어 이 두 정보를 가지고 MMU는 변환한다.

## 메모리 보호 기법

다른 프로그램의 영역을 침범할 수 있는 명령어는 위험하기 때문에 논리 주소의 영역을 벗어나는 명령어는 실행되어서는 안 된다.

이러한 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호하는 **한계 레지스터**(limit register)가 존재한다.

### 한계 레지스터

- 프로그램의 영역을 침범할 수 있는 명령어의 실행을 막음
- 베이스 레지스터가 실행 중인 프로그램의 가장 작은 물리 주소를 저장한다면, 한계 레지스터는 논리 주소의 최대 크기를 저장
- 베이스 레지스터 값 <= 프로그램의 물리 주소 범위 < 베이스 레지스터 + 한계 레지스터 값

